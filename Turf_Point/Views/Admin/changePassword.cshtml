@{
    ViewData["Title"] = "Change Password";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div class="container-fluid">

    <div class="row justify-content-center">
        <div class="col-md-5">

            <div class="card shadow-sm mt-4">
                <div class="card-header bg-light fw-bold">
                    Change Password
                </div>

                <div class="card-body">

                    <!-- Old Password -->
                    <div class="mb-3">
                        <label class="form-label">Old Password</label>
                        <input type="password" id="oldPassword" class="form-control" />
                        <label class="text-danger small" id="oldPasswordError"></label>
                    </div>

                    <!-- New Password -->
                    <div class="mb-3">
                        <label class="form-label">New Password</label>
                        <input type="password" id="newPassword" class="form-control" />
                        <label class="text-danger small" id="newPasswordError"></label>
                    </div>

                    <!-- Confirm Password -->
                    <div class="mb-3">
                        <label class="form-label">Confirm Password</label>
                        <input type="password" id="confirmPassword" class="form-control" />
                        <label class="text-danger small" id="confirmPasswordError"></label>
                    </div>

                    <!-- Result Message -->
                    <div class="mb-3">
                        <label id="resultMessage" class="fw-semibold"></label>
                    </div>

                    <div class="d-grid">
                        <button id="btnChangePassword" class="btn btn-primary">
                            Change Password
                        </button>
                    </div>

                </div>
            </div>

        </div>
    </div>

</div>

<script>
    $(document).ready(function () {

        $('#btnChangePassword').click(function () {
            clearErrors();

            const oldPassword = $('#oldPassword').val().trim();
            const newPassword = $('#newPassword').val().trim();
            const confirmPassword = $('#confirmPassword').val().trim();

            let isValid = true;

            // Validation
            if (oldPassword === "") {
                $('#oldPasswordError').text("Old password is required");
                isValid = false;
            }

            if (newPassword === "") {
                $('#newPasswordError').text("New password is required");
                isValid = false;
            } else if (newPassword.length < 6) {
                $('#newPasswordError').text("Password must be at least 6 characters");
                isValid = false;
            }

            if (confirmPassword === "") {
                $('#confirmPasswordError').text("Confirm password is required");
                isValid = false;
            } else if (newPassword !== confirmPassword) {
                $('#confirmPasswordError').text("Passwords do not match");
                isValid = false;
            }

            if (!isValid) return;

            // API Call
            $.ajax({
                url: '@Url.Content("~/api/Admin/ChangePassword")',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({
                    id: localStorage.getItem("adminId"),
                    oldPassword: oldPassword,
                    newPassword: newPassword
                }),
                success: function (response) {
                    if (response.status === "Ok") {
                        $('#resultMessage').removeClass('text-danger').addClass('text-success').text(response.message);

                        $('#oldPassword, #newPassword, #confirmPassword').val('');
                    } else {
                        $('#resultMessage')
                            .removeClass('text-success')
                            .addClass('text-danger')
                            .text(response.message);
                    }
                },
                error: function () {
                    $('#resultMessage')
                        .addClass('text-danger')
                        .text("Something went wrong. Please try again.");
                }
            });
        });

        function clearErrors() {
            $('#oldPasswordError').text('');
            $('#newPasswordError').text('');
            $('#confirmPasswordError').text('');
            $('#resultMessage').text('');
        }
    });
</script>
