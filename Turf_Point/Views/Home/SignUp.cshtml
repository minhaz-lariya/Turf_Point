
@{
    ViewData["Title"] = "Sign Up | Rangoonwala Turf";
    Layout = "~/Views/Shared/_UserLayout.cshtml";
}

<section class="container-fluid py-4" style="background: linear-gradient(135deg, #d4edda, #e9ecef);margin-top: -15px;">
    <div class="container d-flex flex-column flex-md-row justify-content-between align-items-center">
        <!-- Left Side Title -->
        <div class="mb-2 mb-md-0">
            <h2 class="mb-0 fw-bold" style="color: #2f855a;">Sign Up</h2>
        </div>

        <!-- Right Side Breadcrumb -->
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb mb-0 p-2 rounded-pill shadow-sm"
                style="background: linear-gradient(135deg, #a8e6a3, #d1d5db);">
                <li class="breadcrumb-item">
                    <a href="#" class="text-decoration-none fw-semibold" style="color: #1f7a3f;">
                        <i class="bi bi-house-fill me-1"></i> Home
                    </a>
                </li>
                <li class="breadcrumb-item active text-secondary fw-semibold" aria-current="page">
                    Sign Up
                </li>
            </ol>
        </nav>
    </div>
</section>

<div class="container py-5">
    <div class="row shadow-lg rounded-4 overflow-hidden">
        <!-- Left Column: Full Image -->
        <div class="col-lg-6 d-none d-lg-block p-0">
            <div class="h-100 w-100" style="background: url('@Url.Content("~/box-cricket-setup.jpg")') center center/cover no-repeat;"></div>
        </div>

        <!-- Right Column: Registration Form -->
        <div class="col-lg-6 bg-white p-5 d-flex align-items-center justify-content-center">
            <div class="w-100" style="max-width: 450px;">
                <div id="errorSummary" class="alert alert-danger d-none"></div>
                <div id="successMsg" class="alert alert-success d-none"></div>

                <form id="registrationForm" novalidate>
                    <div class="mb-3">
                        <label for="FullName" class="form-label fw-semibold">Full Name <span class="text-danger">*</span></label>
                        <input type="text" class="form-control shadow-sm mb-3" id="FullName" name="FullName"
                               required maxlength="100" placeholder="Enter full name">
                    </div>
                    <div class="mb-3">
                        <label for="ContactNo" class="form-label fw-semibold">Contact Number <span class="text-danger">*</span></label>
                        <input type="tel" class="form-control shadow-sm mb-3" id="ContactNo" name="ContactNo"
                               required pattern="[0-9]{10}" placeholder="Enter 10-digit phone number">
                    </div>
                    <div class="mb-3">
                        <label for="UserName" class="form-label fw-semibold">Email (Username) <span class="text-danger">*</span></label>
                        <input type="email" class="form-control shadow-sm mb-3" id="UserName" name="UserName"
                               required placeholder="Enter email">
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6 mb-3 mb-md-0">
                            <label for="Password" class="form-label fw-semibold">Password <span class="text-danger">*</span></label>
                            <input type="password" class="form-control shadow-sm" id="Password" name="Password"
                                   required minlength="6" maxlength="255" placeholder="Enter password">
                        </div>
                        <div class="col-md-6">
                            <label for="ConfirmPassword" class="form-label fw-semibold">Confirm Password <span class="text-danger">*</span></label>
                            <input type="password" class="form-control shadow-sm" id="ConfirmPassword" name="ConfirmPassword"
                                   required placeholder="Re-enter password">
                        </div>
                    </div>

                    <div class="d-grid mt-3">
                        <button type="submit" class="btn btn-primary btn-lg fw-semibold shadow-sm">Sign Up</button>
                    </div>
                </form>

                <p class="text-center mt-3 text-muted">Already have an account? <a href="@Url.Content("~/Sign-In")" class="text-decoration-none fw-semibold">Login</a></p>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        $("#registrationForm").on("submit", function(e) {
            e.preventDefault();

            // Clear previous messages
            $("#errorSummary").addClass("d-none").html('');
            $("#successMsg").addClass("d-none").html('');

            let fullName = $("#FullName").val().trim();
            let contactNo = $("#ContactNo").val().trim();
            let userName = $("#UserName").val().trim();
            let password = $("#Password").val().trim();
            let confirmPassword = $("#ConfirmPassword").val().trim();

            let errors = [];

            // Client-side validation
            if (!fullName) errors.push("Full Name is required.");
            if (!/^[0-9]{10}$/.test(contactNo)) errors.push("Contact Number must be 10 digits.");
            if (!userName) errors.push("Valid Email is required.");
            if (password.length < 6) errors.push("Password must be at least 6 characters.");
            if (password !== confirmPassword) errors.push("Passwords do not match.");

            if (errors.length > 0) {
                $("#errorSummary").html("<ul><li>" + errors.join("</li><li>") + "</li></ul>").removeClass("d-none");
                return;
            }

            // Disable button and show "Please wait..."
            let submitBtn = $(this).find("button[type='submit']");
            let originalText = submitBtn.text();
            submitBtn.prop("disabled", true).text("Please wait...");

            $.ajax({
                url: "@Url.Content("~/api/Registration/Save")",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({
                    FullName: fullName,
                    ContactNo: contactNo,
                    UserName: userName,
                    Password: password
                }),
                success: function (res) {
                    // If jQuery already parsed JSON, no need for JSON.parse
                    console.log(res);

                    if(res.status === "OK"){
                        $("#successMsg").text(res.result).removeClass("d-none");
                        $("#registrationForm")[0].reset();
                    } else {
                        $("#errorSummary").text(res.result || "Something went wrong!").removeClass("d-none");
                    }
                },
                error: function (xhr) {
                    let serverError;
                    try {
                        serverError = JSON.parse(xhr.responseText);
                        if (serverError.errors) {
                            let list = "<ul>";
                            serverError.errors.forEach(err => list += "<li>" + err + "</li>");
                            list += "</ul>";
                            $("#errorSummary").html(list).removeClass("d-none");
                        } else {
                            $("#errorSummary").text(serverError.message || "Something went wrong!").removeClass("d-none");
                        }
                    } catch {
                        $("#errorSummary").text(xhr.responseText || "Something went wrong!").removeClass("d-none");
                    }
                },
                complete: function() {
                    // Re-enable button and reset text
                    submitBtn.prop("disabled", false).text(originalText);
                }
            });
        });
    });
</script>


<style>
    .form-control:focus {
        border-color: #0d6efd;
        box-shadow: 0 0 10px rgba(13, 110, 253, 0.2);
    }

    .btn-primary:hover {
        background: linear-gradient(90deg, #0d6efd, #6c63ff);
        border-color: #6c63ff;
    }

    .breadcrumb a {
        color: #0d6efd;
    }

    .breadcrumb a:hover {
        text-decoration: underline;
    }

    .row.shadow-lg {
        min-height: 600px;
    }
</style>
